import{c as fe,j as e,u as ve,a as ye,b as be,d as _,r as c,L as je,C as we,F as S,P as Ie,G as T,B as r,T as m,E as J,I as Se,e as k,f as C,g as K,M as Q,h as Te,Q as g}from"./index-7eb3e469.js";import{S as ke,a as Y,b as X}from"./Stepper-5f6625b9.js";import{F as D,I as P,O as A}from"./OutlinedInput-42254326.js";import{I as p}from"./InputAdornment-796da98e.js";import{F as L}from"./FormHelperText-b8c529e9.js";import{L as Ce}from"./Lock-d70a65ee.js";import{V as De,a as Pe}from"./VisibilityOff-ba84383b.js";import{A as Ae}from"./ArrowBack-94ac059f.js";import{C as Le,a as Oe}from"./CardContent-7428a288.js";import{K as Ee}from"./VpnKey-eb620edb.js";import{C as $e}from"./Checkbox-96b9d7b6.js";const ee=fe(e.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security"),Fe={"akriti786shukla@gmail.com":!1};function Ge(){const{login:O,setisAdmin:E,setisLogin:$,skipotp:te,verifyOtp:oe,sendOtpByEmail:F}=ve(),W=ye(),B=be(),f=_(B.breakpoints.down("md"));_(B.breakpoints.down("sm"));const[a,u]=c.useState({email:"",password:"",otp:"",devicedetails:"Not Available",loginTime:"",clientInfo:{}}),[d,v]=c.useState({}),[y,z]=c.useState(!1),[b,ne]=c.useState(!1),[s,M]=c.useState("login"),[N,ae]=c.useState(0),[x,R]=c.useState(0),[Z,V]=c.useState(!1),[j,H]=c.useState(!1),[ie,U]=c.useState(!1),[q,re]=c.useState(!0);c.useEffect(()=>{let t;return x>0?t=setInterval(()=>{R(x-1)},1e3):V(!1),()=>clearInterval(t)},[x]);const h=()=>new Date().toISOString().replace("T"," ").substr(0,19),G=()=>{const t=Intl.DateTimeFormat().resolvedOptions().timeZone,o=new Date().getTimezoneOffset(),n=Math.abs(Math.floor(o/60)),i=Math.abs(o%60),I=o>0?"-":"+";return`${t} (UTC${I}${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")})`},se=()=>{var t;return{screenWidth:window.screen.width,screenHeight:window.screen.height,colorDepth:window.screen.colorDepth,pixelRatio:window.devicePixelRatio,screenOrientation:((t=screen.orientation)==null?void 0:t.type)||"N/A"}},le=async()=>{let t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return t?{effectiveType:t.effectiveType,downlink:t.downlink,rtt:t.rtt,saveData:t.saveData}:"Network info not available"},ce=()=>({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,languages:navigator.languages,cookiesEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,vendor:navigator.vendor,maxTouchPoints:navigator.maxTouchPoints,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory||"N/A"});c.useEffect(()=>{(async()=>{try{const o=await navigator.getBattery(),n={level:(o.level*100).toFixed(0),charging:o.charging,chargingTime:o.chargingTime,dischargingTime:o.dischargingTime},i=await le(),I=se(),xe=ce(),l={loginDateTime:h(),timeZone:G(),battery:n,network:i,screen:I,browser:xe,platform:{os:navigator.platform,vendor:navigator.vendor,userAgent:navigator.userAgent}},he=`Login Time (UTC): ${l.loginDateTime}
          TimeZone: ${l.timeZone}
          Device: ${l.platform.os}
          Browser: ${l.browser.vendor}
          Screen: ${l.screen.screenWidth}x${l.screen.screenHeight}
          Battery: ${l.battery.level}% (${l.battery.charging?"Charging":"Not Charging"})
          Network: ${typeof l.network=="object"?l.network.effectiveType:"N/A"}
          Language: ${l.browser.language}`.trim();u(pe=>({...pe,devicedetails:he,loginTime:l.loginDateTime,clientInfo:l})),U(!0)}catch(o){console.error("Error fetching device details: ",o);const n={loginDateTime:h(),timeZone:G(),platform:navigator.platform,userAgent:navigator.userAgent};u(i=>({...i,devicedetails:`Login Time: ${n.loginDateTime}, Device: ${n.platform}`,loginTime:n.loginDateTime,clientInfo:n})),U(!0),g.error("Error fetching complete device details")}})()},[]);const w=t=>{const{name:o,value:n}=t.target;u({...a,[o]:n}),d[o]&&v({...d,[o]:null})},de=()=>{const t={};return a.email?/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(a.email)||(t.email="Please enter a valid email address"):t.email="Email is required",s==="login"&&!a.password?t.password="Password is required":s==="login"&&a.password.length<6&&(t.password="Password must be at least 6 characters"),s==="otp"&&!a.otp&&(t.otp="OTP is required"),v(t),Object.keys(t).length===0},me=async t=>{if(t.preventDefault(),de()){z(!0);try{if(te||Fe[a.email]){const o={...a,loginTimestamp:h()},n=await O(o);n!=null&&n.valid?($(n.valid),E(n.isAdmin),localStorage.setItem("isAdmin",n.isAdmin),localStorage.setItem("isLogin",n.valid),localStorage.setItem("token",n.token),localStorage.setItem("custommerid",n.custommerId),localStorage.setItem("lastLoginTime",o.loginTimestamp),localStorage.setItem("clientInfo",JSON.stringify(a.clientInfo)),g.success("Welcome back!"),setTimeout(()=>{window.location.reload(),W("/")},2e3)):g.error("User may not exist or the password is incorrect. Please check your credentials or create an account.")}else if(s==="login")await F(a.email),g.success("OTP sent to your email"),M("otp");else if(s==="otp"){const o=await oe(a.email,a.otp);if(o!=null&&o.valid){const n={...a,loginTimestamp:h()},i=await O(n);i!=null&&i.valid?($(i.valid),E(i.isAdmin),localStorage.setItem("isAdmin",i.isAdmin),localStorage.setItem("isLogin",i.valid),localStorage.setItem("token",i.token),localStorage.setItem("custommerid",i.custommerId),localStorage.setItem("lastLoginTime",n.loginTimestamp),localStorage.setItem("clientInfo",JSON.stringify(a.clientInfo)),g.success("Welcome back!"),setTimeout(()=>{window.location.reload(),W("/")},2e3)):(g.error("User may not exist or the password is incorrect. Please check your credentials or create an account."),setTimeout(()=>{window.location.reload()},3e3))}else g.error(o.message||"Invalid OTP. Please try again.")}}catch{g.error("An error occurred. Please try again.")}finally{z(!1)}}},ge=async()=>{if(N<5)try{H(!0),await F(a.email),g.success("OTP resent to your email"),ae(N+1),V(!0),R(60)}catch{g.error("Failed to resend OTP. Please try again.")}finally{H(!1)}else g.error("You have reached the maximum resend attempts. Please try again later.")},ue=()=>{M("login"),u({...a,otp:""}),v({...d,otp:null})};return e.jsx(je,{title:"Dmarg - Login",children:e.jsx(we,{maxWidth:"md",sx:{py:{xs:2,md:8}},children:e.jsx(S,{in:ie,timeout:600,children:e.jsx(Ie,{elevation:5,sx:{borderRadius:2,overflow:"hidden",bgcolor:"background.paper"},children:e.jsxs(T,{container:!0,children:[!f&&e.jsxs(T,{item:!0,md:5,sx:{background:"linear-gradient(to bottom, #00796b, #004d40)",p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",color:"white"},children:[e.jsxs(r,{sx:{mb:4},children:[e.jsx(ee,{sx:{fontSize:60,mb:2,opacity:.8}}),e.jsx(m,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Welcome Back"}),e.jsx(m,{variant:"body1",sx:{opacity:.9,mb:2},children:"Log in to access your D-Marg account and track your devices securely."}),e.jsxs(r,{sx:{mt:4},children:[e.jsx(m,{variant:"subtitle2",sx:{opacity:.8,fontSize:"0.85rem"},children:"Secure login with two-factor authentication"}),e.jsx(m,{variant:"subtitle2",sx:{opacity:.8,fontSize:"0.85rem"},children:"End-to-end encrypted connection"})]})]}),e.jsx(r,{sx:{position:"absolute",bottom:20,opacity:.7},children:e.jsxs(m,{variant:"caption",children:["Â© ",new Date().getFullYear()," D-Marg by Skoegle"]})})]}),e.jsxs(T,{item:!0,xs:12,md:7,sx:{p:{xs:2,sm:4},display:"flex",flexDirection:"column"},children:[e.jsxs(r,{sx:{mb:4,textAlign:f?"center":"left"},children:[f&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(ee,{color:"primary",sx:{fontSize:40}})}),e.jsx(m,{variant:"h4",fontWeight:"bold",color:"primary",sx:{mb:1},children:s==="login"?"Sign In":"Verify OTP"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:s==="login"?"Enter your credentials to access your account":` We've sent a verification code to ${a.email}`})]}),e.jsxs(ke,{activeStep:s==="login"?0:1,alternativeLabel:!0,sx:{mb:4},children:[e.jsx(Y,{children:e.jsx(X,{children:"Credentials"})}),e.jsx(Y,{children:e.jsx(X,{children:"Verification"})})]}),e.jsxs(r,{component:"form",onSubmit:me,sx:{width:"100%"},children:[s==="login"?e.jsx(S,{in:s==="login",timeout:500,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(D,{variant:"outlined",fullWidth:!0,error:!!d.email,children:[e.jsx(P,{htmlFor:"email",children:"Email Address"}),e.jsx(A,{id:"email",type:"email",name:"email",value:a.email,onChange:w,startAdornment:e.jsx(p,{position:"start",children:e.jsx(J,{color:"action"})}),label:"Email Address"}),d.email&&e.jsx(L,{children:d.email})]}),e.jsxs(D,{variant:"outlined",fullWidth:!0,error:!!d.password,children:[e.jsx(P,{htmlFor:"password",children:"Password"}),e.jsx(A,{id:"password",type:b?"text":"password",name:"password",value:a.password,onChange:w,startAdornment:e.jsx(p,{position:"start",children:e.jsx(Ce,{color:"action"})}),endAdornment:e.jsx(p,{position:"end",children:e.jsx(Se,{"aria-label":"toggle password visibility",onClick:()=>ne(!b),edge:"end",children:b?e.jsx(De,{}):e.jsx(Pe,{})})}),label:"Password"}),d.password&&e.jsx(L,{children:d.password})]}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(m,{variant:"body2",component:k,to:"/forgotpassword",target:"_blank",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Forgot Password?"})})]})}):e.jsx(S,{in:s==="otp",timeout:500,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(r,{sx:{mb:1},children:[e.jsx(C,{startIcon:e.jsx(Ae,{}),onClick:ue,sx:{color:"text.secondary",mb:2},children:"Back to Login"}),e.jsx(Le,{variant:"outlined",sx:{mb:2,bgcolor:"primary.50"},children:e.jsxs(Oe,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(J,{color:"primary",sx:{mr:1}}),e.jsx(m,{variant:"body2",fontWeight:"medium",children:a.email})]}),e.jsx(m,{variant:"caption",color:"text.secondary",children:"Please check your email inbox for the OTP and enter it below"})]})})]}),e.jsxs(D,{variant:"outlined",fullWidth:!0,error:!!d.otp,children:[e.jsx(P,{htmlFor:"otp",children:"Enter OTP"}),e.jsx(A,{id:"otp",name:"otp",value:a.otp,onChange:w,startAdornment:e.jsx(p,{position:"start",children:e.jsx(Ee,{color:"action"})}),label:"Enter OTP"}),d.otp&&e.jsx(L,{children:d.otp})]}),e.jsx(C,{variant:"outlined",color:"secondary",disabled:Z||j,onClick:ge,startIcon:j&&e.jsx(K,{size:16,color:"inherit"}),children:j?"Resending...":Z?`Resend OTP (${x}s)`:"Resend OTP"})]})}),e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx($e,{checked:q,onChange:t=>re(t.target.checked)}),e.jsxs(m,{children:["By creating an account, you agree to the"," ",e.jsx(Q,{variant:"body2",component:k,to:"https://skoegle.in/Terms%20and%20Conditions.html",target:"_blank",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Terms and Conditions"})]})]}),e.jsx(r,{children:e.jsx(C,{variant:"contained",color:"primary",fullWidth:!0,type:"submit",disabled:!q||y,startIcon:y?e.jsx(K,{size:20,color:"inherit"}):e.jsx(Te,{}),sx:{mt:3,py:1.2,borderRadius:30,backgroundColor:"#00796b",fontWeight:"bold","&:hover":{backgroundColor:"#00635a"},boxShadow:2},children:y?"Please wait...":"Continue"})})]}),s==="login"&&e.jsx(r,{sx:{mt:3,textAlign:"center"},children:e.jsxs(m,{variant:"body2",children:["Don't have an account?"," ",e.jsx(Q,{component:k,to:"/signup",sx:{fontWeight:"bold",color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Sign Up"})]})})]})]})]})})})})})}export{Ge as default};
