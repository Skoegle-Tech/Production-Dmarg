import{c as ue,j as e,u as me,r as s,b as he,d as xe,L as M,C as $,P as Y,G as n,ay as pe,B as o,ax as fe,T as h,F as Z,E as ge,t as je,f as x,g as D,Q as c}from"./index-7eb3e469.js";import{a as p,B as G,C as be,S as ye}from"./Save-4764234f.js";import{T as ve,a as H,E as Pe}from"./Edit-90796f30.js";import{P as A}from"./Person-205868f6.js";import{K}from"./VpnKey-eb620edb.js";import{T as d}from"./TextField-041322db.js";import{C as Q,a as _}from"./CardContent-7428a288.js";import{D as Ce,a as we,b as Ie,c as Ne}from"./DialogTitle-6f4034cb.js";import{D as Se}from"./DialogContentText-a298a922.js";import{R as Oe}from"./Refresh-becb9bf5.js";import"./colorManipulator-fa7bdb26.js";import"./OutlinedInput-42254326.js";import"./Select-237f65fb.js";import"./FormHelperText-b8c529e9.js";const Ee=ue(e.jsx("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen");function He(){const{fetchUserProfile:F,updateUserProfile:J,sendOtpByEmail:W,verifyOtp:X}=me(),[Te,U]=s.useState(null),[f,v]=s.useState(!1),[r,I]=s.useState({}),[g,V]=s.useState({}),[k,z]=s.useState(!0),[l,De]=s.useState(!1),[i,N]=s.useState({}),[j,ee]=s.useState(0),B=he(),te=xe(B.breakpoints.down("sm")),[Ae,S]=s.useState(!1),[P,O]=s.useState(""),[C,L]=s.useState(!1),[R,b]=s.useState(""),[re,w]=s.useState(!1),[E,u]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const t=await F();U(t==null?void 0:t.user);const m={firstName:(t==null?void 0:t.user.firstName)||"",lastName:(t==null?void 0:t.user.lastName)||"",email:(t==null?void 0:t.user.email)||"",phoneNumber:(t==null?void 0:t.user.phoneNumber)||"",custommerId:(t==null?void 0:t.user.custommerId)||"",password:(t==null?void 0:t.user.password)||""};I(m),V(m),z(!1)}catch(t){console.error("Error fetching user profile:",t),c.error("Unable to load profile data"),z(!1)}})()},[F]);const T=s.useMemo(()=>!g||Object.keys(g).length===0?!1:Object.keys(r).some(a=>a==="password"&&!r[a]?!1:r[a]!==g[a]),[r,g]),y=a=>{const{name:t,value:m}=a.target;I({...r,[t]:m}),i[t]&&N({...i,[t]:null})},ae=()=>{const a={};r.firstName||(a.firstName="First name is required"),r.lastName||(a.lastName="Last name is required"),r.email||(a.email="Email is required"),r.phoneNumber||(a.phoneNumber="Phone number is required"),r.password&&r.password.length<6&&(a.password="Password must be at least 6 characters");const t=/^[0-9]{10}$/;r.phoneNumber&&!t.test(r.phoneNumber)&&(a.phoneNumber="Phone number must be 10 digits");const m=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;return r.email&&!m.test(r.email)&&(a.email="Invalid email format"),a},se=async()=>{if(!T){v(!1);return}const a=ae();if(N(a),!(Object.keys(a).length>0))try{w(!0),u(!0),await W(r.email),S(!0),u(!1),c.success("Verification code sent to your email")}catch(t){console.error("Error sending OTP:",t),u(!1),c.error("Failed to send verification code. Please try again."),w(!1)}},ie=a=>{O(a.target.value),b("")},ne=async()=>{try{u(!0),await W(r.email),u(!1),c.success("New verification code sent to your email")}catch(a){console.error("Error resending OTP:",a),u(!1),c.error("Failed to send verification code. Please try again.")}},oe=async()=>{if(!P||P.trim()===""){b("Please enter the verification code");return}try{if(L(!0),await X(r.email,P)){const t={...r};await J(t),V({...r}),w(!1),S(!1),O(""),v(!1),c.success("Profile updated successfully!")}else b("Invalid verification code. Please try again.")}catch(a){console.error("Error during verification or update:",a),b("Verification failed. Please try again."),c.error("Failed to verify or update profile. Please try again.")}finally{L(!1)}},q=()=>{w(!1),S(!1),O(""),b("")},le=(a,t)=>{ee(t)},ce=()=>!r.firstName||!r.lastName?"U":`${r.firstName.charAt(0)}${r.lastName.charAt(0)}`,de=()=>{I({...g}),N({}),v(!1)};return k?e.jsx(M,{title:"Dmarg - Profile",children:e.jsx($,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsx(Y,{elevation:3,sx:{p:4,borderRadius:2},children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsxs(n,{item:!0,xs:12,md:4,container:!0,direction:"column",alignItems:"center",children:[e.jsx(p,{variant:"circular",width:120,height:120}),e.jsx(p,{variant:"text",width:"80%",height:30,sx:{mt:2}}),e.jsx(p,{variant:"text",width:"60%",height:20})]}),e.jsxs(n,{item:!0,xs:12,md:8,children:[e.jsx(p,{variant:"text",width:"40%",height:40}),e.jsx(p,{variant:"rectangular",width:"100%",height:100,sx:{mt:2}}),e.jsx(p,{variant:"rectangular",width:"100%",height:100,sx:{mt:2}})]})]})})})}):e.jsxs(M,{title:"Dmarg - Profile",children:[e.jsx($,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsx(pe,{direction:"down",in:!k,timeout:500,children:e.jsxs(Y,{elevation:3,sx:{borderRadius:2,overflow:"hidden",bgcolor:"background.paper",transition:"all 0.3s ease-in-out"},children:[e.jsx(o,{sx:{p:4,bgcolor:"primary.main",color:"primary.contrastText",background:"linear-gradient(to right, #00796b, #4db6ac)"},children:e.jsxs(n,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(n,{item:!0,children:e.jsx(fe,{sx:{width:80,height:80,bgcolor:"white",color:"primary.main",fontSize:32,fontWeight:"bold",border:"4px solid white",boxShadow:B.shadows[3]},children:ce()})}),e.jsxs(n,{item:!0,xs:!0,children:[e.jsxs(h,{variant:"h4",fontWeight:"bold",children:[r.firstName," ",r.lastName]}),e.jsxs(o,{display:"flex",alignItems:"center",mt:.5,children:[e.jsx(G,{fontSize:"small"}),e.jsx(h,{variant:"subtitle1",sx:{ml:1,opacity:.8},children:r.custommerId})]})]})]})}),e.jsx(o,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ve,{value:j,onChange:le,variant:te?"fullWidth":"standard",indicatorColor:"secondary",children:[e.jsx(H,{label:"Personal Details",icon:e.jsx(A,{}),iconPosition:"start",sx:{fontWeight:"medium"}}),e.jsx(H,{label:"Account Security",icon:e.jsx(K,{}),iconPosition:"start",sx:{fontWeight:"medium"}})]})}),e.jsxs(o,{sx:{p:3},children:[j===0&&e.jsx(Z,{in:j===0,timeout:500,children:e.jsx(o,{children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(d,{label:"First Name",variant:"outlined",fullWidth:!0,disabled:!f||l,name:"firstName",value:r.firstName,onChange:y,error:!!i.firstName,helperText:i.firstName,InputProps:{startAdornment:e.jsx(A,{color:"action",sx:{mr:1}})}})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(d,{label:"Last Name",variant:"outlined",fullWidth:!0,disabled:!f||l,name:"lastName",value:r.lastName,onChange:y,error:!!i.lastName,helperText:i.lastName,InputProps:{startAdornment:e.jsx(A,{color:"action",sx:{mr:1}})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{label:"Email Address",variant:"outlined",fullWidth:!0,disabled:!0,name:"email",value:r.email,onChange:y,error:!!i.email,helperText:i.email,InputProps:{startAdornment:e.jsx(ge,{color:"action",sx:{mr:1}})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{label:"Phone Number",variant:"outlined",fullWidth:!0,disabled:!f||l,name:"phoneNumber",value:r.phoneNumber,onChange:y,error:!!i.phoneNumber,helperText:i.phoneNumber,InputProps:{startAdornment:e.jsx(je,{color:"action",sx:{mr:1}})}})})]})})}),j===1&&e.jsx(Z,{in:j===1,timeout:500,children:e.jsxs(o,{children:[e.jsx(Q,{variant:"outlined",sx:{mb:3},children:e.jsxs(_,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Change Password"}),e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Update your password to keep your account secure. Your password should be at least 6 characters long."}),e.jsx(d,{label:"New Password",variant:"outlined",fullWidth:!0,type:"password",name:"password",value:r.password||"",onChange:y,disabled:!f||l,error:!!i.password,helperText:i.password,InputProps:{startAdornment:e.jsx(K,{color:"action",sx:{mr:1}})},sx:{mt:2}})]})}),e.jsx(Q,{variant:"outlined",children:e.jsxs(_,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Account ID"}),e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Your unique account identifier."}),e.jsx(o,{display:"flex",alignItems:"center",children:e.jsx(d,{variant:"outlined",fullWidth:!0,value:r.custommerId||"",disabled:!0,InputProps:{readOnly:!0,startAdornment:e.jsx(G,{color:"action",sx:{mr:1}})}})})]})})]})}),e.jsx(o,{sx:{mt:4,display:"flex",justifyContent:"flex-end",gap:2},children:f?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"outlined",color:"inherit",startIcon:e.jsx(be,{}),onClick:de,disabled:l,children:"Cancel"}),e.jsx(x,{variant:"contained",color:"primary",startIcon:l?e.jsx(D,{size:20,color:"inherit"}):e.jsx(ye,{}),onClick:se,disabled:l||!T,children:l?"Saving...":T?"Save Changes":"No Changes"})]}):e.jsx(x,{variant:"contained",color:"primary",startIcon:e.jsx(Pe,{}),onClick:()=>v(!0),children:"Edit Profile"})})]})]})})}),e.jsxs(Ce,{open:re,onClose:q,"aria-labelledby":"otp-dialog-title",maxWidth:"xs",fullWidth:!0,children:[e.jsx(we,{id:"otp-dialog-title",children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(Ee,{sx:{mr:1,color:"primary.main"}}),"Verify Your Identity"]})}),e.jsxs(Ie,{children:[e.jsxs(Se,{sx:{mb:2},children:["For security purposes, we've sent a verification code to your email ",r.email,". Please enter the code below to complete your profile update."]}),E?e.jsx(o,{sx:{display:"flex",justifyContent:"center",my:3},children:e.jsx(D,{size:40})}):e.jsxs(e.Fragment,{children:[e.jsx(d,{autoFocus:!0,margin:"dense",label:"Verification Code",type:"text",fullWidth:!0,variant:"outlined",value:P,onChange:ie,error:!!R,helperText:R,inputProps:{maxLength:6},placeholder:"Enter 6-digit code",sx:{mt:1}}),e.jsx(o,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(x,{size:"small",startIcon:e.jsx(Oe,{}),onClick:ne,disabled:E,children:"Resend Code"})})]})]}),e.jsxs(Ne,{sx:{px:3,pb:3},children:[e.jsx(x,{onClick:q,color:"inherit",disabled:C,children:"Cancel"}),e.jsx(x,{onClick:oe,variant:"contained",color:"primary",disabled:C||E,startIcon:C?e.jsx(D,{size:16,color:"inherit"}):null,children:C?"Verifying...":"Verify & Update"})]})]})]})}export{He as default};
